<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace='boardMapper'>

	<!-- FAQ 리스트 조회 -->
	<select id='selectFAQ' resultMap='FAQBoard'>
		select * 
		from FAQ
	</select>
	
	<resultMap id="FAQBoard" type='Board'>
		<id column="FAQ_NO" property="boardNo"/>
		<result column="FAQ_TITLE" property="boardTitle"/>
		<result column="FAQ_REPLY" property="boardContent"/>
		<result column="UPDATE_DATE" property="boardModifyDate"/>
	</resultMap>
	<!-- FAQ 리스트 조회 -->
	
	<select id='getListCount' resultType='_int'>
		select count(*)
		from board
		where board_active = 'Y' and cate_no = #{i}
	</select>
	
	<!-- 문의/예약 게시글 리스트 조회 -->
	<select id="selectAllQueBookList" resultMap='quBoBoard'>
		select *
		from in_bo_board_view
		where board_active = 'Y' and cate_no = #{i}
		order by board_no desc
	</select>
	
	<resultMap type="Board" id="quBoBoard">
		<result column="WRITER_NO" property="boardWriterNo"/>
		<result column="WRITER_NAME" property="boardWriterName"/>
		<result column="MODIFY_DATE" property="boardModifyDate"/>
		<result column="CREATE_DATE" property="boardCreateDate"/>
		<result column="IN_BO_STATUS" property="quBoBoardStatus"/>
	</resultMap>
	<!-- 문의/예약 게시글 리스트 조회 -->
	
	<!-- 게시글 등록 -->
	<insert id="insertBoard" useGeneratedKeys="true">
		<selectKey resultType="_int" keyProperty="boardNo" order="BEFORE">
			select seq_board.nextval from dual
		</selectKey>
		insert into board
			values(#{boardNo}, #{cateNo}, #{boardWriterNo}, #{boardWriterName}, #{boardTitle},
					#{boardContent}, default, default, sysdate, sysdate)
	</insert>
	<!-- 게시글 등록 -->
	<!-- 이미지 등록 -->
	<insert id="insertImg">
		insert all
			<foreach collection="list" item="img" separator=" ">
				into Image values(new_img_id, #{img.imgPath}, #{img.imgName}, #{img.imgRename}, #{img.imgRefNum}, #{img.imgRefType}, default)
			</foreach>
		select * from dual
	</insert>
	<!-- 이미지 등록 -->
	
	<!-- 문의/예약 등록 -->
	<insert id="insertQuBo">
		insert into inquiry_book
			values(#{boardNo}, #{writerPhone}, default, #{boPwd})
	</insert>
	<!-- 문의/예약 등록 -->
	
	<!-- 상세 글 조회 -->
	<select id="selectBoard" resultMap='quBoBoard'>
		select *
			from IN_BO_BOARD_VIEW
			where board_no = #{bId}
	</select>
	<!-- 상세 글 조회 -->
	
	<!-- 게시글 카운트 업데이트 -->
	<update id="updateCount">
		update board
			set BOARD_COUNT = BOARD_COUNT + 1
			WHERE BOARD_NO = #{bId}
	</update>
	<!-- 게시글 카운트 업데이트 -->
	
	<!-- 게시글의 이미지 조회 -->
	<select id="selectImg" resultType='Image'>
		select *
		from image
		where img_ref_num = #{bId} and img_ref_type = 'BOARD'
	</select>
	<!-- 게시글의 이미지 조회 -->
	
	<!-- 게시글 삭제 -->
	<update id="deleteBoard">
		update board
			set board_active = 'N'
			where board_no = #{boardNo}
	</update>
	<!-- 게시글 삭제 -->
	
	<!-- 게시글의 이미지 삭제 -->
	<update id="deleteImg">
		update image
			set img_active = 'N'
			where img_ref_num = #{boardNo} and img_ref_type = 'BOARD'
	</update>
	<!-- 이미지 삭제 -->
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</mapper>
